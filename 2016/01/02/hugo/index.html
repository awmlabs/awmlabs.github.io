<!DOCTYPE html>
<html lang="ja-JP">
<head>
<meta charset="utf-8">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="awmlabs">
<meta name="generator" content="Hugo 0.17-DEV" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type="text/css">
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="awm-Tech">
<title>Hugo のサマリーが大きすぎる件 - awm-Tech</title>
</head>
<body>

<header>
  <div class="container">
    <a class="path" href="https://blog.awm.jp/">[awm-Tech]</a>
    <span class="caret"># _</span>
  </div>
</header>

<div class="container">


<main role="main" class="article">
  

<article class="single" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="meta">
    <div style="float:left;">  
<div id="fb-root"></div>
<script>(function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
        fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="fb-like" data-href=" https://blog.awm.jp/2016/01/02/hugo/" data-colorscheme="light" data-layout="button_count" data-action="like" data-show-faces="true" data-send="false"></div>
<a href="http://b.hatena.ne.jp/entry/blog.awm.jp/2016/01/02/hugo/" class="hatena-bookmark-button" data-hatena-bookmark-title="Hugo のサマリーが大きすぎる件" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリー
をはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="https://blog.awm.jp/2016/01/02/hugo/" data-lang="ja" data-hashtags="awmtech">ツイート</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
 </div>

    <span class="key">published on</span>
    <span class="val"><time itemprop="datePublished" datetime="2016-01-02">January 02, 2016</time></span>


    <span class="key">in</span>
    <span class="val">

        <a href="https://blog.awm.jp/categories/hugo">Hugo</a>

    </span>


    <br>
    <span class="key">tags:</span>
    <span class="val">

        <a href="https://blog.awm.jp/tags/blog">Blog</a>

        <a href="https://blog.awm.jp/tags/hugo">Hugo</a>

    </span>

  </div>
  <h1 class="headline" itemprop="headline">Hugo のサマリーが大きすぎる件</h1>

  <section class="body" itemprop="articleBody">
    <nav id="TableOfContents">
<ul>
<li><a href="#はじめに">はじめに</a></li>
<li><a href="#hugo-のサマリーの実例">Hugo のサマリーの実例</a></li>
<li><a href="#サマリーの仕様">サマリーの仕様</a></li>
<li><a href="#実装">実装</a></li>
</ul>
</nav>
    

<h1 id="はじめに">はじめに</h1>

<p>Hugo でブログサイトを作ってみたけれど、サマリーが大きすぎるので行数を減らしたかった。結論は以下の通り。</p>

<ul>
<li>config.toml の頭に hasCJKLanguage = true を入れる</li>
<li>もしくは、 各々の markdown ファイルの先頭で isCJKLanguage = true を入れる</li>
</ul>

<p>そこまで辿り着くまでの話です。
尚、ドキュメントに明記されてました。恥ずかしいっ (*ノノ</p>

<ul>
<li><a href="https://gohugo.io/overview/configuration">https://gohugo.io/overview/configuration</a></li>
</ul>

<pre><code># if true, auto-detect Chinese/Janapese/Korean Languages in the content.
 (.Summary and .WordCount can work properly in CJKLanguage)
hasCJKLanguage              false
</code></pre>

<ul>
<li><a href="https://gohugo.io/content/front-matter">https://gohugo.io/content/front-matter</a></li>
</ul>

<pre><code>**isCJKLanguage** If true, explicitly treat the content as CJKLanguage
 (.Summary and .WordCount can work properly in CJKLanguage)
</code></pre>

<h1 id="hugo-のサマリーの実例">Hugo のサマリーの実例</h1>

<p>デフォルトだと以下のようにサマリーが巨大になります。
<center> <img src="/2016/01/02/ss1_h.png" title="figure-1" > </center></p>

<p>hasCJK 又は isCJK の設定を入れると以下のように自然なサイズになります。</p>

<p><center> <img src="/2016/01/02/ss2_h.png" title="figure-2"/> </center></p>

<h1 id="サマリーの仕様">サマリーの仕様</h1>

<ul>
<li><a href="https://gohugo.io/content/summaries/">https://gohugo.io/content/summaries/</a></li>
</ul>

<pre><code>By default, Hugo automatically takes the first 70 words of your content as its
summary and stores it into the .Summary variable, which you may use in your
templates.
</code></pre>

<p>単語を70個だけ表示するそうです。
By default なので値を 70 以外に変える方法があると推測し、ドキュメントを漁りましたが見つかりません。</p>

<p>仕方ないので、実装を見る事にします。</p>

<ul>
<li><a href="https://github.com/spf13/hugo">https://github.com/spf13/hugo</a></li>
</ul>

<h1 id="実装">実装</h1>

<ul>
<li>github.com/spf13/hugo/hugolib/page.go</li>
</ul>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">if</span> <span style="color: #a6e22e">p</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isCJKLanguage</span> <span style="color: #f8f8f2">{</span>
	<span style="color: #a6e22e">summary</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">truncated</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">helpers</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">TruncateWordsByRune</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">p</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">PlainWords</span><span style="color: #f8f8f2">(),</span> <span style="color: #a6e22e">helpers</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">SummaryLength</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #f8f8f2">{</span>
	<span style="color: #a6e22e">summary</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">truncated</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">helpers</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">TruncateWordsToWholeSentence</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">p</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">PlainWords</span><span style="color: #f8f8f2">(),</span> <span style="color: #a6e22e">helpers</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">SummaryLength</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>削る処理では helper で定義している SummaryLength を参照しています。</p>

<ul>
<li>github.com/spf13/hugo/helpers/content.go</li>
</ul>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">// Length of the summary that Hugo extracts from a content.</span>
<span style="color: #66d9ef">var</span> <span style="color: #a6e22e">SummaryLength</span> <span style="color: #f8f8f2">=</span> <span style="color: #ae81ff">70</span>
</pre></div>


<p>この SummaryLength を上書きする処理が何処にも無いので、設定で単語数を減らす事は出来なさそうです。(結論からいうと、そもそも数を減らす対策は間違えてる)</p>

<p>よくよく見返すと、</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">if</span> <span style="color: #a6e22e">p</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isCJKLanguage</span> <span style="color: #f8f8f2">{</span>
	<span style="color: #a6e22e">summary</span><span style="color: #f8f8f2">,</span> <span style="color: #a6e22e">truncated</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">helpers</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">TruncateWordsByRune</span><span style="color: #f8f8f2">(</span>
</pre></div>


<p>CJK (中国語、日本語、韓国語をひっくるめた総称) と判定した場合に、マルチバイト文字を意識して単語毎に分割してます。それ以外だとアルファベット等として空白で分割でしょう。</p>

<p>日本語は単語の間に空白を挟みません。単語が連結して見えて少なく数えてしまっているようです。
さて、この isCJKLanguage は何処で設定されるのでしょう。</p>

<ul>
<li>github.com/spf13/hugo/hugolib/page.go</li>
</ul>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">case</span> <span style="color: #e6db74">&quot;iscjklanguage&quot;</span><span style="color: #f8f8f2">:</span>
	<span style="color: #a6e22e">isCJKLanguage</span> <span style="color: #f8f8f2">=</span> <span style="color: #f8f8f2">new(</span><span style="color: #66d9ef">bool</span><span style="color: #f8f8f2">)</span>
	<span style="color: #f92672">*</span><span style="color: #a6e22e">isCJKLanguage</span> <span style="color: #f8f8f2">=</span> <span style="color: #a6e22e">cast</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">ToBool</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">v</span><span style="color: #f8f8f2">)</span>
</pre></div>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">if</span> <span style="color: #a6e22e">isCJKLanguage</span> <span style="color: #f92672">!=</span> <span style="color: #66d9ef">nil</span> <span style="color: #f8f8f2">{</span>
	<span style="color: #a6e22e">p</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isCJKLanguage</span> <span style="color: #f8f8f2">=</span> <span style="color: #f92672">*</span><span style="color: #a6e22e">isCJKLanguage</span>
<span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #66d9ef">if</span> <span style="color: #a6e22e">viper</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">GetBool</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;HasCJKLanguage&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
	<span style="color: #66d9ef">if</span> <span style="color: #a6e22e">cjk</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">Match</span><span style="color: #f8f8f2">(</span><span style="color: #a6e22e">p</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">rawContent</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
		<span style="color: #a6e22e">p</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isCJKLanguage</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">true</span>
	<span style="color: #f8f8f2">}</span> <span style="color: #66d9ef">else</span> <span style="color: #f8f8f2">{</span>
		<span style="color: #a6e22e">p</span><span style="color: #f8f8f2">.</span><span style="color: #a6e22e">isCJKLanguage</span> <span style="color: #f8f8f2">=</span> <span style="color: #66d9ef">false</span>
	<span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">}</span>
</pre></div>
</p>

<p>設定キーワードらしい文字列が見つかりましたし、これ以上ソースを見るのは面倒なので、後はドキュメントを検索しました。</p>

<pre><code>$ cd github.com/spf13/hugo
$ grep -ri iscjklanguage docs
docs/content/content/front-matter.md:* **isCJKLanguage** If true, explicitly treat the content as CJKLanguage (.Summary and .WordCount can work properly in CJKLanguage)
$ grep -ri hascjklanguage  docs
docs/content/overview/configuration.md:    hasCJKLanguage              false
</code></pre>

<p>後は対応する URL を開いて確認するだけです。(冒頭で紹介した URL)</p>

<ul>
<li><a href="https://gohugo.io/overview/configuration">https://gohugo.io/overview/configuration</a></li>
<li><a href="https://gohugo.io/content/front-matter">https://gohugo.io/content/front-matter</a></li>
</ul>

<p>以上、 同じ罠にハマった方のお役に立てれば幸いです！</p>

  </section>
</article>

</main>


</div>

<footer>
  <div class="container">
    <span class="copyright">&copy; 2016  awm-Tech - <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></span>
  </div>
</footer>

</body>
</html>

